# .github/workflows/main-cicd.yml
name: CI/CD SQL Deployment with Manual Approval

on:
  push:
    branches: [ main ]
    paths: [ 'Database/**' ]

jobs:
  development:
    name: Deploy to Development (Local)
    uses: ./.github/workflows/sql-template.yml
    with:
      sql_server: ${{ secrets.SQL_SERVER }}
      sql_user: ${{ secrets.SQL_USER }}
      sql_pass: ${{ secrets.SQL_PASS }}
      sql_file: Database/setup1.sql

  production:
    name: Deploy to Production (with approval)
    needs: development
    runs-on: ubuntu-latest
    environment:
      name: production
      url: 'https://rnimg-102-66-182-14.a.free.pinggy.link:44225'

    steps:
      - name: Call SQL deployment template
        uses: ./.github/workflows/sql-template.yml
        with:
          sql_server: ${{ secrets.PROD_SQL_SERVER }}
          sql_user: ${{ secrets.PROD_SQL_USER }}
          sql_pass: ${{ secrets.PROD_SQL_PASS }}
          sql_file: Database/setup1.sql
